<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-4">
    <div class="container" style="max-width: 600px;">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="m-0">üè¶ Secure Banking</h4>
            </div>
            <div class="card-body" id="content">
                <div id="loginSection">
                    <h5>Login</h5>
                    <form id="loginForm">
                        <div class="mb-3">
                            <input type="text" id="username" class="form-control" placeholder="Username" value="user"
                                required>
                        </div>
                        <div class="mb-3">
                            <input type="password" id="password" class="form-control" placeholder="Password"
                                value="pass123" required>
                        </div>
                        <button type="submit" class="btn btn-success">Login</button>
                    </form>
                </div>
                <div id="dashboard" style="display: none;">
                    <h5>Welcome, <span id="displayName"></span>!</h5>
                    <p>Balance: $<span id="balance">1000</span></p>
                    <div class="alert alert-info">
                        Session ID: <code id="sessionDisplay"></code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        let sessionId = params.get('session') || generateSessionId();

        function generateSessionId() {
            return 'sess_' + Math.random().toString(36).substr(2, 9);
        }

        // Vulnerable: Session ID in URL
        if (!params.get('session')) {
            window.history.pushState({}, '', '?session=' + sessionId);
        }

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const user = document.getElementById('username').value;

            // Store user data in session (simulated)
            sessionStorage.setItem(sessionId, JSON.stringify({
                username: user,
                balance: user === 'admin' ? 999999 : 1000
            }));

            showDashboard(user);
        });

        function showDashboard(user) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            const data = JSON.parse(sessionStorage.getItem(sessionId) || '{}');
            document.getElementById('displayName').textContent = data.username || user;
            document.getElementById('balance').textContent = data.balance || 1000;
            document.getElementById('sessionDisplay').textContent = sessionId;

            if (data.username === 'admin') {
                document.getElementById('dashboard').innerHTML += `
                    <div class="alert alert-success mt-3">
                        <strong>Admin Access!</strong><br>
                        FLAG{session_fixation_exploited}
                    </div>
                `;
            }
        }

        // Auto-login if session exists
        const existingData = sessionStorage.getItem(sessionId);
        if (existingData) {
            const data = JSON.parse(existingData);
            showDashboard(data.username);
        }
    </script>
</body>

</html>