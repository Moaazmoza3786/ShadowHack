
# Privilege Escalation: Linux & Windows

## From User to God
Getting a shell is great, but getting `root` or `NT AUTHORITY\SYSTEM` is the goal.
**Privilege Escalation** is the art of abusing misconfigurations to gain higher permissions.

## 1. Linux Privilege Escalation
In Linux, "Everything is a file". Permissions on files dictate your power.

### SUID Binaries (Set User ID)
A binary with the SUID bit set runs with the permissions of the *owner* (usually root), not the *user* who ran it.
-   **Classic Example:** `passwd` needs SUID to modify `/etc/shadow`.
-   **Vulnerability:** If `nmap` or `vim` has SUID, we can use it to spawn a root shell.

**Finding SUID Files:**
`find / -perm -u=s -type f 2>/dev/null`

<CodeBlock language="bash" showLineNumbers code={`# Exploiting SUID Nmap (Old versions)
nmap --interactive
nmap> !sh
# Whoami
root
`} />

### Kernel Exploits (Dirty Cow)
If the kernel itself has a bug, no amount of file permissions will save you.
-   **Dirty Cow (CVE-2016-5195):** A race condition in the Copy-on-Write mechanism allowing any user to write to read-only files (like `/etc/passwd`).

## 2. Windows Privilege Escalation
Windows is complex. It relies on Tokens, Services, and Registry keys.

### Token Impersonation (Potato Attacks)
Windows uses "Tokens" to track identity. Accounts like `LocalService` have special privileges (SE_IMPERSONATE_PRIVILEGE).
-   **Attack:** Force `SYSTEM` to authenticate to a rogue I/O pipe you control.
-   **Result:** You steal the `SYSTEM` token and become God.
-   **Tools:** JuicyPotato, RottenPotato, PrintSpoofer.

### Unquoted Service Paths
If a service path is `C:\Program Files\My Service\service.exe` (no quotes), Windows tries to execute:
1.  `C:\Program.exe`
2.  `C:\Program Files\My.exe`
3.  `C:\Program Files\My Service\service.exe`

If you can write a malicious `Program.exe` in `C:\`, it will run as SYSTEM next time the service starts.

<Mermaid chart={`
graph TD
    A[Initial Foothold (User)] --> B{Enumeration}
    B -->|SUID/Capabilities| C[Linux Root]
    B -->|Kernel Exploit| D[Kernel Ring 0]
    B -->|Misconfigured Service| E[Windows SYSTEM]
    
    style C fill:#ef4444,stroke:#fff,stroke-width:2px,color:#fff
    style D fill:#ef4444,stroke:#fff,stroke-width:2px,color:#fff
    style E fill:#ef4444,stroke:#fff,stroke-width:2px,color:#fff
`} />

## 3. Automated Enumeration Tools
Don't verify manually until you have run the scripts.
-   **Linux:** LinPEAS (`linpeas.sh`)
-   **Windows:** WinPEAS (`winpeas.exe`)

<TerminalSimulator 
    cmd="./linpeas.sh" 
    output={`
ADVERTISEMENT:
[+] Red/Yellow = 95% Root Vulnerability
[+] Sudo tokens:
    [!] Vulnerable to CVE-2019-14287 (Sudo)
[+] SUID binaries:
    [!] /usr/bin/find (Unknown SUID binary!) -> GTFOBins
[+] Cron jobs:
    [!] /etc/cron.d/backup.sh is writable by 'user'
`} 
/>

## 4. GTFOBins
The bible of Linux privilege escalation. If you find a binary that you can run as root (via Sudo or SUID), check **GTFOBins** to see if it allows shell spawning.
-   **Vim:** `:!/bin/sh`
-   **Find:** `find . -exec /bin/sh \;`
-   **Less:** `!/bin/sh`

---

<Quiz 
    question="You verify `whoami /priv` on a compromised Windows machine and see `SeImpersonatePrivilege` enabled. Which class of tools should you immediately consider?" 
    options={[
        "Mimikatz",
        "Potato Exploits (JuicyPotato/PrintSpoofer)",
        "Kernel Exploits",
        "Unquoted Service Paths"
    ]} 
    answer="Potato Exploits (JuicyPotato/PrintSpoofer)" 
/>
