
# Broken Authentication & Session Management

## The Keys to the Kingdom
If I can log in as you, I **am** you. Broken Authentication acts as a bypass for all other security controls.

This vulnerability class includes weak passwords, poor session management, and logic flaws in the login process.

## 1. Brute Force & Credential Stuffing
-   **Brute Force:** Trying every combo (`admin/1234`, `admin/password`).
-   **Credential Stuffing:** Using databases leaked from *other* sites (e.g., LinkedIn dump) to log into your target. Users reuse passwords everywhere.

### Tool: Hydra
Hydra is the fastest network login cracker.

<TerminalSimulator 
    cmd="hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.5 http-post-form '/login.php:user=^USER^&pass=^PASS^:Invalid username'" 
    output={`[DATA] max 16 tasks per 1 server, overall at 16 tasks.
[DATA] attacking http-post-form://10.10.10.5:80/login.php
[VERBOSE] Resolving '10.10.10.5' (10.10.10.5)
[80][http-post-form] host: 10.10.10.5   login: admin   password: princess
[STATUS] 16.00 tries/min, 16 tries in 00:01h, 1 todo in 00:01h
[80][http-post-form] host: 10.10.10.5   login: admin   password: 123456
1 of 1 target successfully completed, 1 valid password found
`} 
/>

## 2. Session Hijacking
When you log in, the server gives you a **Session ID** (Cookie). If I steal that ID, I can access your account without your password.

### Cookie Attributes
A secure cookie *must* have:
-   **Secure:** Only send over HTTPS.
-   **HttpOnly:** JavaScript (`document.cookie`) cannot read it (Prevents XSS theft).
-   **SameSite:** Strict/Lax (Prevents CSRF).

<CodeBlock language="javascript" showLineNumbers code={`// Vulnerable Cookie (Default)
Set-Cookie: PHPSESSID=12345; path=/;

// Secure Cookie
Set-Cookie: PHPSESSID=12345; path=/; Secure; HttpOnly; SameSite=Strict`} />

## 3. JWT Attacks (JSON Web Tokens)
JWTs are common in modern Single Page Apps (React/Vue).
A JWT looks like `aaaaa.bbbbb.ccccc` (Header.Payload.Signature).

### The "None" Algorithm Attack
The header specifies the hashing algorithm (e.g., HS256).
If the server trusts the user input, we can change `"alg": "HS256"` to `"alg": "none"` and remove the signature.

<Mermaid chart={`
graph LR
    A[Attacker] --> B[Decodes JWT]
    B --> C[Changes 'alg' to 'none']
    C --> D[Changes 'admin': false to true]
    D --> E[Removes Signature]
    E --> F[Sends to Server]
    F --> G{Server accepts 'none'?}
    G -- Yes --> H[Admin Access Granted]
    G -- No --> I[Rejected]
    
    style H fill:#ef4444,stroke:#fff,stroke-width:2px,color:#fff
`} />

## Remediation strategies
1.  **Multi-Factor Authentication (MFA):** The single most effective defense against credential theft.
2.  **Rate Limiting:** Block IP after 5 failed attempts (Fail2Ban).
3.  **Session Timeout:** Auto-logout after 15 minutes of inactivity.

---

<Quiz 
    question="You find a Session Cookie with the 'HttpOnly' flag set. What attack does this primarily prevent?" 
    options={[
        "SQL Injection",
        "Session Hijacking via MITM (Man-in-the-Middle)",
        "Session Hijacking via XSS (Cross-Site Scripting)",
        "Brute Force attacks"
    ]} 
    answer="Session Hijacking via XSS (Cross-Site Scripting)" 
/>
