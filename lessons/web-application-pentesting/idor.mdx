
# Insecure Direct Object References (IDOR)

## I See What You See
IDOR is the simplest logic bug to understand, yet it accounts for massive data breaches.
It happens when an application exposes a reference to an internal object (like a User ID or File ID) but fails to check if the current user has permission to access it.

## 1. The Anatomy of an IDOR
Imagine a medical portal:
`https://hospital.com/records/view?id=1001`

-   **User A (ID 1001)** logs in and sees their X-Ray.
-   **User A** changes the URL to `id=1002`.
-   **Server checks:** "Is the user logged in?" -> YES.
-   **Server checks:** "Does Record 1002 exist?" -> YES.
-   **Server checks:** "Does User A own Record 1002?" -> **NO CHECK IMPLEMENTED.**
-   **Result:** User A sees User B's X-Ray.

## 2. Horizontal vs. Vertical Escalation
-   **Horizontal:** Accessing data of users at the *same* privilege level (User A -> User B).
-   **Vertical:** Accessing data of a higher privilege level (User -> Admin).

## 3. Finding IDORs
IDORs are rarely found by scanners because the server returns HTTP 200 OK (Logic Error, not Syntax Error).

### Strategy: The "Two User" Method
1.  Create two accounts: **Attacker** and **Victim**.
2.  Login as **Victim** and find a sensitive object (e.g., Invoice #555).
3.  Login as **Attacker** and try to access Invoice #555.

<TerminalSimulator 
    cmd="curl 'http://api.target.com/v1/invoices/555' -H 'Authorization: Bearer ATTACKER_TOKEN'" 
    output={`HTTP/1.1 200 OK
Content-Type: application/json

{
  "invoice_id": 555,
  "user": "victim_account",
  "amount": "$10,000",
  "cc_last4": "4242"
}
`} 
/>
**Verdict:** Vulnerable! The server accepted the Attacker's token for the Victim's resource.

## 4. Complex IDORs (GUIDs & Hashing)
Developers often think using long IDs (GUIDs) prevents IDOR. It does not; it just makes it harder to *guess* (Insecurity through Obscurity).
-   **Predictable:** `user_id=100` -> `user_id=101`.
-   **GUID:** `user_id=550e8400-e29b-41d4-a716-446655440000`. If I find this GUID in a public comment or shared link, I can still use it to attack.

<CodeBlock language="javascript" showLineNumbers code={`// Vulnerable Code (Express.js)
app.get('/messages/:id', (req, res) => {
    // Fails to check if req.session.user_id matches the message owner
    db.query('SELECT * FROM messages WHERE id = ?', [req.params.id], (err, row) => {
        res.json(row);
    });
});

// Secure Code
app.get('/messages/:id', (req, res) => {
    db.query('SELECT * FROM messages WHERE id = ? AND owner_id = ?', 
    [req.params.id, req.session.user_id], (err, row) => {
        if (!row) return res.status(403).send("Access Denied");
        res.json(row);
    });
});
`} />

---

<Quiz 
    question="You find a URL: `site.com/profile?user_id=500`. You change it to `user_id=501` and see another user's profile. However, all the data visible (Name, Avatar) is public information anyway. Is this a Critical Vulnerability?" 
    options={[
        "Yes, it is always Critical",
        "No, it is likely 'Information Disclosure' or 'Intended Functionality' if the data is public",
        "Yes, because you changed the ID",
        "No, because you didn't get admin access"
    ]} 
    answer="No, it is likely 'Information Disclosure' or 'Intended Functionality' if the data is public" 
/>
